<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akari Markdown å…¨åŠŸèƒ½å±•ç¤º</title>
    <style>
        /* =========================================
           1. å¤–éƒ¨æ¨£å¼æ±™æŸ“æ¸¬è©¦ (Global Style Pollution)
           é€™è£¡æ•…æ„å¯«ä¸€äº›å¾ˆé†œã€å¾ˆå…·ç ´å£æ€§çš„æ¨£å¼ã€‚
           å¦‚æœ Shadow DOM é‹ä½œæ­£å¸¸ï¼Œå³å´é è¦½å€å®Œå…¨ä¸æ‡‰å—åˆ°å½±éŸ¿ã€‚
           ========================================= */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a1a;
            color: #ddd;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* è©¦åœ–ç ´å£ H1, H2, p, code çš„æ¨£å¼ */
        h1 { color: #ff00ff; text-decoration: underline; font-size: 50px; text-transform: uppercase; }
        p { color: yellow; font-size: 24px; letter-spacing: 5px; }
        code { background: red; color: white; border: 5px solid yellow; }
        pre { background: pink; }
        blockquote { border-left: 10px solid red; background: yellow; color: black; }

        /* =========================================
           2. ç‰ˆé¢ä½ˆå±€ (Layout)
           ========================================= */
        header {
            background: #2d2d2d;
            padding: 10px 20px;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }

        h1.app-title {
            /* é€™æ˜¯ Header çš„æ¨™é¡Œï¼Œæœƒè¢«ä¸Šé¢çš„æ±¡æŸ“æ¨£å¼å½±éŸ¿ (è®Šæˆç²‰ç´…è‰²å¤§å­—) æ˜¯æ­£å¸¸çš„ */
            margin: 0;
            font-size: 24px;
            text-transform: none;
            color: #fff;
            text-decoration: none;
        }

        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* å·¦å´æ§åˆ¶å€ */
        .panel-left {
            width: 400px;
            background: #252526;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #444;
        }

        .toolbar {
            padding: 10px;
            background: #333;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        textarea {
            flex: 1;
            background: #1e1e1e;
            color: #d4d4d4;
            border: none;
            padding: 15px;
            resize: none;
            font-family: Consolas, 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            outline: none;
        }

        /* å³å´é è¦½å€ */
        .panel-right {
            flex: 1;
            background: #0d1117; /* GitHub Dark Background */
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* é€™è£¡è¨­å®š akari-markdown çµ„ä»¶çš„å¤§å° */
        akari-markdown {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            /* å¹³æ»‘æ²å‹• */
            scroll-behavior: smooth;
        }

        /* æŒ‰éˆ•æ¨£å¼ (é‡ç½® p çš„æ±™æŸ“) */
        button {
            padding: 8px 16px;
            background: #0e639c;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
            transition: background 0.2s;
        }
        button:hover { background: #1177bb; }
        button:disabled { background: #555; cursor: not-allowed; }
        button.secondary { background: #444; }

        /* ç‹€æ…‹åˆ— */
        .status-bar {
            padding: 5px 10px;
            background: #007acc;
            color: white;
            font-size: 12px;
            font-family: monospace;
            display: flex;
            justify-content: space-between;
        }
        
        /* ä¿®å¾©å·¦å´èªªæ˜æ–‡å­—è¢«å…¨å±€æ¨£å¼æ±™æŸ“çš„å•é¡Œï¼Œç‚ºäº†è®“ä»‹é¢èƒ½çœ‹ */
        .panel-left p {
            font-size: 14px;
            color: #aaa;
            letter-spacing: normal;
            margin: 5px 10px;
        }
    </style>
</head>
<body>

<header>
    <!-- é€™å€‹æ¨™é¡Œæœƒè¢«æ±¡æŸ“æˆç²‰ç´…è‰²ï¼Œè­‰æ˜å¤–éƒ¨æ¨£å¼ç”Ÿæ•ˆä¸­ -->
    <h1 class="app-title">Akari Markdown Demo</h1>
    <div style="font-size: 12px; color: #aaa;">
        å·¦å´ï¼šè¼¸å…¥ / æ¨¡æ“¬ä¸²æµ &nbsp;|&nbsp; å³å´ï¼šWeb Component (Shadow DOM)
    </div>
</header>

<div class="main-container">
    <!-- å·¦å´ï¼šæ§åˆ¶èˆ‡è¼¸å…¥ -->
    <div class="panel-left">
        <div class="toolbar">
            <button id="btn-showcase">ğŸ“ è¼‰å…¥å…¨åŠŸèƒ½ç¯„ä¾‹</button>
            <button id="btn-stream">ğŸš€ æ¨¡æ“¬ LLM ä¸²æµ</button>
            <button id="btn-clear" class="secondary">ğŸ—‘ï¸ æ¸…ç©º</button>
        </div>
        <p>æ‰‹å‹•ç·¨è¼¯ä¸‹æ–¹å…§å®¹ï¼Œæˆ–é»æ“ŠæŒ‰éˆ•æ¸¬è©¦ï¼š</p>
        <textarea id="source-input" placeholder="åœ¨æ­¤è¼¸å…¥ Markdown..."></textarea>
    </div>

    <!-- å³å´ï¼šé è¦½çµ„ä»¶ -->
    <div class="panel-right">
        <!-- 
            â˜…â˜…â˜… Web Component â˜…â˜…â˜… 
            æ³¨æ„ï¼šé€™è£¡æ²’æœ‰ä»»ä½• classï¼Œæ‰€æœ‰æ¨£å¼éƒ½åœ¨çµ„ä»¶å…§éƒ¨
        -->
        <akari-markdown id="preview"></akari-markdown>
        
        <div class="status-bar">
            <span id="status-text">Ready</span>
            <span id="render-count">Render Count: 0</span>
        </div>
    </div>
</div>

<!-- å¼•å…¥æ¨¡çµ„ -->
<script type="module" src="https://h-o-w-a-r-d.github.io/AKARI-Markdown.js/v1.0.0/akari-markdown.min.js"></script>

<script type="module">
    // æº–å‚™ä¸€å€‹åŒ…å«æ‰€æœ‰èªæ³•çš„è¤‡é›œ Markdown
    const SHOWCASE_CONTENT = `
# Akari Markdown åŠŸèƒ½å±•ç¤º

æ­¡è¿ä½¿ç”¨ **Akari Markdown**ã€‚é€™æ˜¯ä¸€å€‹åŸºæ–¼ Shadow DOM çš„ Web Componentï¼Œç¢ºä¿æ¨£å¼éš”é›¢ä¸”æ”¯æ´ä¸²æµè¼¸å‡ºã€‚

> **æ³¨æ„è§€å¯Ÿ**ï¼šé é¢å¤–éƒ¨çš„ \`H1\` æ˜¯ç²‰ç´…è‰²çš„ï¼Œ\`P\` æ˜¯é»ƒè‰²çš„ï¼Œä½†åœ¨é€™å€‹å€å¡Šå…§ï¼Œæ¨£å¼ä¿æŒä¹¾æ·¨çš„ GitHub é¢¨æ ¼ã€‚

---

## 1. æ•¸å­¸å…¬å¼ (KaTeX)
æ”¯æ´è¡Œå…§èˆ‡å€å¡Šå…¬å¼ï¼Œæ¸²æŸ“å¿«é€Ÿã€‚

- **è¡Œå…§**ï¼šè³ªèƒ½äº’æ› $E = mc^2$ èˆ‡æ­æ‹‰æ†ç­‰å¼ $e^{i\\pi} + 1 = 0$ã€‚
- **å€å¡Š** (é«˜æ–¯ç©åˆ†)ï¼š
$$
\\int_{-\\infty}^\\infty e^{-x^2} dx = \\sqrt{\\pi}
$$

çŸ©é™£ç¯„ä¾‹ï¼š
$$
A = \\begin{pmatrix}
a & b \\\\
c & d
\\end{pmatrix}
$$

---

## 2. ç¨‹å¼ç¢¼é«˜äº® (Highlight.js)
æ”¯æ´è‡ªå‹•åµæ¸¬èªè¨€èˆ‡è¡Œè™Ÿæ¨£å¼ã€‚

\`\`\`javascript
// å³ä½¿åœ¨ Shadow DOM å…§ï¼Œé«˜äº®ä¹Ÿèƒ½æ­£å¸¸é‹ä½œ
class Greeter {
    constructor(name) {
        this.name = name;
    }
    
    sayHello() {
        console.log(\`Hello, \${this.name}!\`);
    }
}
\`\`\`

\`\`\`python
def fib(n):
    a, b = 0, 1
    while a < n:
        print(a, end=' ')
        a, b = b, a+b
\`\`\`

---

## 3. Mermaid åœ–è¡¨ (æ”¯æ´é˜²æŠ–)
åœ¨ä¸²æµè¼¸å…¥æ™‚ï¼Œåœ–è¡¨æœƒç­‰å¾…èªæ³•å®Œæ•´å¾Œæ‰æ¸²æŸ“ï¼Œä¸æœƒé–ƒçˆå ±éŒ¯ã€‚

### æµç¨‹åœ– (Flowchart)
\`\`\`mermaid
graph TD
    A[ä½¿ç”¨è€…è¼¸å…¥] --> B{æ¨¡å¼?}
    B -->|éœæ…‹| C[ç›´æ¥æ¸²æŸ“]
    B -->|ä¸²æµ| D[å•Ÿå‹•ç¯€æµ]
    D --> E[æ›´æ–°æ–‡å­— DOM]
    E --> F[é˜²æŠ–è¨ˆæ™‚å™¨]
    F --> G[ç¹ªè£½ Mermaid]
\`\`\`

### åœ“é¤…åœ– (Pie Chart)
\`\`\`mermaid
pie title å°ˆæ¡ˆèªè¨€åˆ†ä½ˆ
    "JavaScript" : 45
    "HTML/CSS" : 25
    "Markdown" : 20
    "Other" : 10
\`\`\`

### å¾ªåºåœ– (Sequence Diagram)
\`\`\`mermaid
sequenceDiagram
    participant U as User
    participant C as Component
    participant S as ShadowDOM

    U->>C: è¨­å®š value = text
    C->>S: æ³¨å…¥ CSS (ä¸€æ¬¡æ€§)
    C->>C: è§£æ Markdown
    C->>S: update innerHTML
    Note over C,S: æ¨£å¼å®Œå…¨éš”é›¢
\`\`\`

---

## 4. æ¨™æº– Markdown å…ƒç´ 
- **æ¸…å–®**ï¼š
  1. æœ‰åºé …ç›®ä¸€
  2. æœ‰åºé …ç›®äºŒ
     - å­é …ç›® A
     - å­é …ç›® B
- **è¡¨æ ¼**ï¼š

| åŠŸèƒ½ | æ”¯æ´ | èªªæ˜ |
| :--- | :---: | :--- |
| Shadow DOM | âœ… | æ¨£å¼éš”é›¢ |
| KaTeX | âœ… | æ•¸å­¸æ¸²æŸ“ |
| Mermaid | âœ… | æµç¨‹åœ– |

- **é€£çµ**ï¼š[å‰å¾€ Google](https://google.com)
- **åˆªé™¤ç·š**ï¼š~~é€™æ˜¯åˆªé™¤çš„å…§å®¹~~
- **HTML æ·¨åŒ–**ï¼šå˜—è©¦æ³¨å…¥ iframe <iframe src="javascript:alert(1)"></iframe> (æ‡‰è¢«éæ¿¾æˆ–å®‰å…¨é¡¯ç¤º)
`;

    // å–å¾—å…ƒç´ 
    const input = document.getElementById('source-input');
    const preview = document.getElementById('preview');
    const statusText = document.getElementById('status-text');
    const renderCountEl = document.getElementById('render-count');
    
    let renderCount = 0;
    let streamInterval = null;

    // 1. è¨­å®š Hooks ç›£è½æ¸²æŸ“ç‹€æ…‹
    preview.config = {
        throttleInterval: 30,  // æ–‡å­—æ›´æ–°é »ç‡
        mermaidDebounce: 800,  // åœ–è¡¨é˜²æŠ–æ™‚é–“
        hooks: {
            // åœ¨ DOM æ›´æ–°å®Œæˆå¾Œè§¸ç™¼
            onRendered: (el) => {
                renderCount++;
                renderCountEl.textContent = `Render Count: ${renderCount}`;
                
                // è‡ªå‹•æ²å‹•åˆ°åº•éƒ¨ (æ¨¡æ“¬èŠå¤©è¦–çª—è¡Œç‚º)
                // é€™è£¡è¦åˆ¤æ–·æ˜¯å¦æ­£åœ¨ä¸²æµï¼Œå¦‚æœæ˜¯æ‰æ²å‹•
                if (streamInterval) {
                    el.scrollTop = el.scrollHeight;
                }
            },
            beforeParse: (md) => {
                // å¯ä»¥åœ¨é€™è£¡åšä¸€äº›å‰è™•ç†ï¼Œä¾‹å¦‚å°‡ \n è½‰ç‚º <br>
                return md; 
            }
        }
    };

    // 2. ç¶å®šæŒ‰éˆ•åŠŸèƒ½
    
    // åŠŸèƒ½å±•ç¤º
    document.getElementById('btn-showcase').addEventListener('click', () => {
        stopStream();
        input.value = SHOWCASE_CONTENT;
        preview.value = SHOWCASE_CONTENT;
        statusText.textContent = "å·²è¼‰å…¥å…¨åŠŸèƒ½ç¯„ä¾‹";
    });

    // æ¸…ç©º
    document.getElementById('btn-clear').addEventListener('click', () => {
        stopStream();
        input.value = '';
        preview.value = '';
        statusText.textContent = "å·²æ¸…ç©º";
    });

    // æ¨¡æ“¬ LLM ä¸²æµ
    document.getElementById('btn-stream').addEventListener('click', () => {
        stopStream();
        statusText.textContent = "ğŸš€ ä¸²æµæ¨¡æ“¬ä¸­...";
        preview.value = ''; // å…ˆæ¸…ç©ºé è¦½
        input.value = '';
        
        const content = SHOWCASE_CONTENT;
        let index = 0;
        
        // æ¨¡æ“¬ç¶²è·¯å»¶é²èˆ‡å°åŒ…å¤§å°ä¸ä¸€
        streamInterval = setInterval(() => {
            // æ¯æ¬¡éš¨æ©Ÿå¢åŠ  2 ~ 8 å€‹å­—å…ƒ
            const chunkSize = Math.floor(Math.random() * 6) + 2;
            const chunk = content.slice(index, index + chunkSize);
            
            if (!chunk) {
                stopStream();
                statusText.textContent = "âœ… ä¸²æµå®Œæˆ";
                return;
            }
            
            const currentText = input.value + chunk;
            input.value = currentText;
            
            // â˜…â˜…â˜… æ ¸å¿ƒï¼šç›´æ¥è¨­å®š valueï¼Œçµ„ä»¶æœƒè‡ªå‹•è™•ç†ç¯€æµ â˜…â˜…â˜…
            preview.value = currentText;
            
            index += chunkSize;
            
            // æ»¾å‹•è¼¸å…¥æ¡†
            input.scrollTop = input.scrollHeight;

        }, 20); // æ¯ 20ms é€²ä¸€æ¬¡è³‡æ–™ (é€Ÿåº¦å¾ˆå¿«)
    });

    // 3. ç¶å®šæ‰‹å‹•è¼¸å…¥
    input.addEventListener('input', () => {
        stopStream(); // å¦‚æœæ‰‹å‹•è¼¸å…¥å°±åœæ­¢è‡ªå‹•ä¸²æµ
        statusText.textContent = "æ‰‹å‹•ç·¨è¼¯ä¸­...";
        preview.value = input.value;
    });

    function stopStream() {
        if (streamInterval) {
            clearInterval(streamInterval);
            streamInterval = null;
        }
    }

    // åˆå§‹è¼‰å…¥
    window.addEventListener('load', () => {
        input.value = "# Hello Akari!\nè©¦è‘—é»æ“Šä¸Šæ–¹çš„ **å…¨åŠŸèƒ½ç¯„ä¾‹** æŒ‰éˆ•ã€‚";
        preview.value = input.value;
    });

</script>

</body>
</html>
